<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content={get_csrf_token()} />
    <.live_title default="Mydia" suffix=" Â· Phoenix Framework">
      {assigns[:page_title]}
    </.live_title>
    <link phx-track-static rel="stylesheet" href={~p"/assets/css/app.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/js/app.js"}>
    </script>
    <script>
      (() => {
        // Theme switcher with support for dark, light, and system preferences
        const THEME_KEY = 'mydia-theme-preference';
        const THEMES = {
          DARK: 'mydia-dark',
          LIGHT: 'mydia-light',
          SYSTEM: 'system'
        };

        // Get system theme preference
        function getSystemTheme() {
          return window.matchMedia('(prefers-color-scheme: dark)').matches
            ? THEMES.DARK
            : THEMES.LIGHT;
        }

        // Get current theme preference from localStorage or default to system
        function getThemePreference() {
          try {
            return localStorage.getItem(THEME_KEY) || THEMES.SYSTEM;
          } catch (e) {
            return THEMES.SYSTEM;
          }
        }

        // Apply theme to document
        function applyTheme(theme) {
          const actualTheme = theme === THEMES.SYSTEM ? getSystemTheme() : theme;
          document.documentElement.setAttribute('data-theme', actualTheme);
        }

        // Set theme preference and apply it
        function setTheme(preference) {
          try {
            localStorage.setItem(THEME_KEY, preference);
          } catch (e) {
            console.warn('Could not save theme preference:', e);
          }
          applyTheme(preference);
        }

        // Initialize theme on page load
        const currentPreference = getThemePreference();
        applyTheme(currentPreference);

        // Watch for system theme changes when in system mode
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        mediaQuery.addEventListener('change', () => {
          const preference = getThemePreference();
          if (preference === THEMES.SYSTEM) {
            applyTheme(THEMES.SYSTEM);
          }
        });

        // Expose theme switching function globally for UI components
        window.mydiaTheme = {
          setTheme,
          getTheme: getThemePreference,
          getCurrentTheme: () => document.documentElement.getAttribute('data-theme'),
          THEMES
        };
      })();
    </script>
  </head>
  <body class="bg-base-200 text-base-content">
    {@inner_content}
  </body>
</html>
